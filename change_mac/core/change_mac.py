# resources
# ---------------------
#  https://levelup.gitconnected.com/changing-mac-address-using-python-8a16fc4a3563
# https://regex101.com/
# -----------------------
from os import error
import subprocess
import re


class MacChanger():
    def __init__(self) -> None:
        self.MAC = ''

    def get_mac(self, iface):
        self.iface = iface
        #  run ifconfig  by subprocess command
        sub_cmd = subprocess.run(
            ['ifconfig', iface], shell=False, capture_output=True)
        # decode the output  in utf-8 formate
        cmd_output = sub_cmd.stdout.decode('utf-8')
        # by regular expression grab the mac address
        mac_pattern = r'ether\s\w{2}:\w{2}:\w{2}:\w{2}:\w{2}:\w{2}'
        # complie the pattern
        regex = re.compile(mac_pattern)
        # search the mac address
        find_mac = regex.search(cmd_output)
        # only grab the mac
        current_mac = find_mac.group().split(" ")[1]
        self.MAC = current_mac
        return self.MAC

    def change_mac(self, iface, newmac):
        # process to change mac address by command line
        self.error = ''
        # ifconfig eth0 down
        down = subprocess.run(['ifconfig', iface, 'down'],
                              shell=False, capture_output=True)
        self.error = down.stderr.decode('utf-8')
        # set New mac address
        # ifconfig eth0 hw ether 00.11.22.33.44.55
        new_mac = subprocess.run(
            ['ifconfig', iface, 'hw', 'ether', newmac], shell=False, capture_output=True)
        self.error = new_mac.stderr.decode('utf-8')
        # ifconfig eth0 up
        mac_up = subprocess.run(['ifconfig',iface, 'up'], shell=False, capture_output=True)
        self.error = mac_up.stderr.decode('utf-8')
        mac_now = self.get_mac(iface)
        if self.error != "":
            print(self.error)
        
        print('-' * 60)
        print('\tChanging MAC for', iface, 'to', newmac)
        print('\tCurren Mac is : ', mac_now )
        print('-' * 60)

